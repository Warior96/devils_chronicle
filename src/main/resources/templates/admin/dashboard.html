<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org">

<head th:insert="~{index :: head}"></head>


<body>
    <div th:insert="~{index :: navbar}"></div>

    <div class="min-vh-100">

        <!-- Page Header -->
        <div class="page-header">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-12 text-center">
                        <h1>
                            <i class="fas fa-tachometer-alt me-3"></i>
                            <span th:text="${title}">Admin Dashboard</span>
                        </h1>
                        <p class="lead mb-0">
                            <i class="fa-solid fa-shield-halved me-2"></i>
                            Management panel for Devil's Chronicle
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="container pt-2">
            <!-- Success Message -->
            <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show">
                <i class="fas fa-check-circle"></i>
                <span th:text="${successMessage}"></span>
            </div>

            <!-- Quick Actions Card -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="quick-actions-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-bolt me-2"></i> Quick Actions
                            </h5>
                            <div class="row">
                                <div class="col-md-3 mb-2">
                                    <a href="/categories/create" class="btn btn-info w-100">
                                        <i class="fas fa-plus me-2"></i> New category
                                    </a>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <a href="/admin/matches" class="btn btn-primary w-100">
                                        <i class="fas fa-futbol me-2"></i> Manage matches
                                    </a>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <a href="/articles" class="btn btn-warning w-100">
                                        <i class="fas fa-newspaper me-2"></i> View articles
                                    </a>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <a href="/" class="btn btn-secondary w-100">
                                        <i class="fas fa-home me-2"></i> Back to home
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Career Request Statistics -->
            <div class="row mb-4">
                <!-- Pending Career Requests -->
                <div class="col-md-4">
                    <div class="stats-card pending-card">
                        <div class="d-flex justify-content-between align-items-center c-white">
                            <div>
                                <h5>Pending career requests</h5>
                                <h3 th:text="${#lists.size(pendingRequests)}">0</h3>
                            </div>
                            <div>
                                <i class="fas fa-clock fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Accepted Career Requests -->
                <div class="col-md-4">
                    <div class="stats-card accepted-card">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>Accepted career requests</h5>
                                <h3 th:text="${#lists.size(acceptedRequests)}">0</h3>
                            </div>
                            <div>
                                <i class="fas fa-check-circle fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Rejected Career Requests -->
                <div class="col-md-4">
                    <div class="stats-card rejected-card">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>Rejected career requests</h5>
                                <h3 th:text="${#lists.size(rejectedRequests)}">0</h3>
                            </div>
                            <div>
                                <i class="fas fa-times-circle fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Categories management section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="accordion-container">
                        <div class="accordion dashboard-accordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header category-accordion">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#categoriesManagement" aria-expanded="false">
                                        <h5 class="mb-0">
                                            <i class="fas fa-tags me-2"></i> Categories management
                                        </h5>
                                    </button>
                                </h2>
                                <div id="categoriesManagement" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <div th:if="${#lists.isEmpty(categories)}" class="text-center py-4">
                                            <i class="fas fa-exclamation-circle fa-2x c-red mb-3"></i>
                                            <h5>No categories found</h5>
                                            <p>
                                                Create your first category to start organizing articles
                                            </p>
                                            <a href="/categories/create" class="btn btn-success">
                                                <i class="fas fa-plus me-2"></i> Create First Category
                                            </a>
                                        </div>
                                        <div th:unless="${#lists.isEmpty(categories)}">
                                            <div class="table-responsive">
                                                <table class="table table-striped table-dark table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-center">ID</th>
                                                            <th>Name</th>
                                                            <th class="text-center">Articles Count</th>
                                                            <th class="position-relative text-center">
                                                                Actions
                                                                <a href="/categories/create" class="plus-category"
                                                                    title="Add category">
                                                                    <i class="fas fa-plus"></i>
                                                                </a>
                                                            </th>
                                                            <th class="text-center">Details</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr th:each="category : ${categories}">
                                                            <td class="text-center" th:text="${category.id}"></td>
                                                            <td th:text="${category.name}"></td>
                                                            <td class="text-center">
                                                                <span class="badge badge-info"
                                                                    th:text="${category.numberOfArticles ?: 0}"></span>
                                                            </td>
                                                            <td class="text-center">
                                                                <a th:href="@{/categories/edit/{id}(id=${category.id})}"
                                                                    class="btn btn-sm btn-outline-warning me-2">
                                                                    <i class="fas fa-edit"></i> Edit
                                                                </a>
                                                                <a th:href="@{/categories/delete/{id}(id=${category.id})}"
                                                                    class="btn btn-sm btn-outline-danger"
                                                                    onclick="return confirm('Delete this category?')">
                                                                    <i class="fas fa-trash"></i> Delete
                                                                </a>
                                                            </td>
                                                            <td class="text-center">
                                                                <a th:href="@{/categories/search/{id}(id=${category.id})}"
                                                                    class="btn btn-sm btn-outline-info me-2">
                                                                    <i class="fas fa-eye"></i> View
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Career requests sections -->
            <div class="row">
                <div class="col-12">
                    <div class="accordion-container">
                        <div class="accordion dashboard-accordion">
                            <!-- Pending Career Requests Accordion -->
                            <div class="accordion-item career-m">
                                <h2 class="accordion-header pending-accordion">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#pendingCareerRequests" aria-expanded="false">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-clock me-2"></i>
                                            <h5 class="mb-0 me-3">Pending career requests</h5>
                                            <span class="position-relative me-2" th:if="${careerPending > 0}">
                                                <i class="fa-solid fa-bell ms-1 custom-notification-bell"></i>
                                                <span
                                                    class="badge rounded-pill bg-danger c-white fs-7 position-absolute notification custom-notification-badge"
                                                    th:text="${careerPending}"></span>
                                            </span>
                                        </div>
                                    </button>
                                </h2>
                                <div id="pendingCareerRequests" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <div th:if="${#lists.isEmpty(pendingRequests)}" class="text-center py-4">
                                            <i class="fas fa-clock me-2"></i>
                                            <p class="mb-0">No pending requests at the moment</p>
                                        </div>
                                        <div th:unless="${#lists.isEmpty(pendingRequests)}">
                                            <div class="table-responsive">
                                                <table class="table table-striped table-dark table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th class="ps-4">User</th>
                                                            <th>Requested Role</th>
                                                            <th>Opened</th>
                                                            <th>Actions</th>
                                                            <th>Details</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr th:each="request : ${pendingRequests}">
                                                            <td class="ps-4" th:text="${request.user.username}"></td>
                                                            <td>
                                                                <span class="badge bg-warning text-dark requestedRole"
                                                                    th:text="${request.role.name.replace('ROLE_', '')}"></span>
                                                            </td>
                                                            <td>
                                                                <i th:if="${request.isChecked == true}"
                                                                    class="fas fa-2x fa-check-circle text-success"
                                                                    title="Read"></i>
                                                                <i th:if="${request.isChecked == false}"
                                                                    class="fas fa-2x fa-times-circle text-danger"
                                                                    title="Unread"></i>
                                                            </td>
                                                            <td>
                                                                <form
                                                                    th:action="@{/operations/career/request/accept/{id}(id=${request.id})}"
                                                                    method="post" class="d-inline">
                                                                    <button type="submit"
                                                                        class="btn btn-sm btn-success me-2"
                                                                        onclick="return confirm('Accept this request?')">
                                                                        <i class="fas fa-check"></i> Accept
                                                                    </button>
                                                                </form>
                                                                <form
                                                                    th:action="@{/operations/career/request/reject/{id}(id=${request.id})}"
                                                                    method="post" class="d-inline">
                                                                    <button type="submit" class="btn btn-sm btn-danger"
                                                                        onclick="return confirm('Reject this request?')">
                                                                        <i class="fas fa-times"></i> Reject
                                                                    </button>
                                                                </form>
                                                            </td>
                                                            <td>
                                                                <a th:href="@{/operations/career/request/detail/{id}(id=${request.id})}"
                                                                    class="btn btn-sm btn-outline-info me-2">
                                                                    <i class="fas fa-eye"></i> View
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Accepted Requests Accordion -->
                            <div class="accordion-item career-m">
                                <h2 class="accordion-header accepted-accordion">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#acceptedRequests" aria-expanded="false">
                                        <i class="fas fa-check-circle me-2"></i>
                                        <h5 class="mb-0">Accepted career requests</h5>
                                    </button>
                                </h2>
                                <div id="acceptedRequests" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <div th:if="${#lists.isEmpty(acceptedRequests)}" class="text-center py-4">
                                            <i class="fas fa-check-circle me-2"></i>
                                            <p>No accepted requests.</p>
                                        </div>
                                        <div th:unless="${#lists.isEmpty(acceptedRequests)}" class="table-responsive">
                                            <table class="table table-success table-striped table-dark table-sm">
                                                <thead>
                                                    <tr>
                                                        <th class="ps-4">Username</th>
                                                        <th>Current role</th>
                                                        <th>Action</th>
                                                        <th>Details</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="request : ${acceptedRequests}">
                                                        <td class="ps-4" th:text="${request.user.username}"></td>
                                                        <td>
                                                            <span class="badge bg-warning text-dark requestedRole"
                                                                th:text="${request.role.name.replace('ROLE_', '')}"></span>
                                                        </td>
                                                        <td>
                                                            <form
                                                                th:action="@{/operations/career/request/revoke/{id}(id=${request.id})}"
                                                                method="POST" class="d-inline">
                                                                <button type="submit" class="btn btn-sm btn-danger"
                                                                    onclick="return confirm('Reject this request?')">
                                                                    <i class="fas fa-times"></i> Reject
                                                                </button>
                                                            </form>
                                                        </td>
                                                        <td>
                                                            <a th:href="@{/operations/career/request/detail/{id}(id=${request.id})}"
                                                                class="btn btn-sm btn-outline-info me-2">
                                                                <i class="fas fa-eye"></i> View
                                                            </a>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Rejected Requests Accordion -->
                            <div class="accordion-item career-m">
                                <h2 class="accordion-header rejected-accordion">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#rejectedRequests" aria-expanded="false">
                                        <i class="fas fa-times-circle me-2"></i>
                                        <h5 class="mb-0">Rejected career requests</h5>
                                    </button>
                                </h2>
                                <div id="rejectedRequests" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <div th:if="${#lists.isEmpty(rejectedRequests)}" class="text-center py-4">
                                            <i class="fas fa-times-circle me-2"></i>
                                            <p>No rejected requests.</p>
                                        </div>
                                        <div th:unless="${#lists.isEmpty(rejectedRequests)}" class="table-responsive">
                                            <table class="table table-danger table-striped table-dark table-sm">
                                                <thead>
                                                    <tr>
                                                        <th class="ps-4">Username</th>
                                                        <th>Rejected role</th>
                                                        <th>Action</th>
                                                        <th>Details</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="request : ${rejectedRequests}">
                                                        <td class="ps-4" th:text="${request.user.username}"></td>
                                                        <td>
                                                            <span class="badge bg-warning text-dark requestedRole"
                                                                th:text="${request.role.name.replace('ROLE_', '')}"></span>
                                                        </td>
                                                        <td>
                                                            <form
                                                                th:action="@{/operations/career/request/accept/{id}(id=${request.id})}"
                                                                method="POST" class="d-inline">
                                                                <button type="submit"
                                                                    class="btn btn-sm btn-success me-2"
                                                                    onclick="return confirm('Accept this request?')">
                                                                    <i class="fas fa-check"></i> Accept
                                                            </form>
                                                        </td>
                                                        <td>
                                                            <a th:href="@{/operations/career/request/detail/{id}(id=${request.id})}"
                                                                class="btn btn-sm btn-outline-info me-2">
                                                                <i class="fas fa-eye"></i> View
                                                            </a>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:insert="~{index :: footer}"></div>
    <div th:replace="~{index :: script}"></div>

    <script>
        // Auto-dismiss alerts after 5 seconds
        setTimeout(function () {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function (alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>
</body>

</html>